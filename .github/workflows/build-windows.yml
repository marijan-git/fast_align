name: Build FastAlign Windows 32-bit

on:
  push:
    branches:
      - win32-build
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-2019

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up MSYS2 environment
      uses: msys2/setup-msys2@v2
      with:
        update: true
        install: >
          mingw-w64-i686-gcc
          mingw-w64-i686-gcc-c++

    - name: Build FastAlign
      run: |
        cd src
        i686-w64-mingw32-g++ -O3 -std=c++11 -static fast_align.cc -o ../fast_align.exe
        i686-w64-mingw32-g++ -O3 -std=c++11 -static atools.cc -o ../atools.exe

    - name: Upload executables
      uses: actions/upload-artifact@v3
      with:
        name: fastalign-win32
        path: |
          fast_align.exe
          atools.exe
